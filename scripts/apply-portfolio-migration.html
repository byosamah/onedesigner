<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Migration - OneDesigner</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #0a0a0a;
            color: #fafafa;
        }
        h1 {
            color: #f0ad4e;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }
        .step {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .step h2 {
            color: #f0ad4e;
            margin-top: 0;
        }
        pre {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 15px;
            overflow-x: auto;
            position: relative;
        }
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #f0ad4e;
            color: #000;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
        }
        .copy-btn:hover {
            background: #e09d3e;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background: #0f3e0f;
            border: 1px solid #0f0;
            color: #0f0;
        }
        .error {
            background: #3e0f0f;
            border: 1px solid #f00;
            color: #f00;
        }
        .warning {
            background: #3e3e0f;
            border: 1px solid #ff0;
            color: #ff0;
        }
        a {
            color: #f0ad4e;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        button {
            background: #f0ad4e;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 0;
        }
        button:hover {
            background: #e09d3e;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>üöÄ Portfolio Migration Tool</h1>
    
    <div class="status warning">
        ‚ö†Ô∏è <strong>Important:</strong> The portfolio columns need to be added to the database manually through Supabase Dashboard.
    </div>

    <div class="step">
        <h2>Step 1: Add Database Columns</h2>
        <p>Open your Supabase SQL Editor and run this query:</p>
        <pre id="sql-query">-- Add portfolio image columns to designers table
ALTER TABLE designers 
ADD COLUMN IF NOT EXISTS portfolio_image_1 TEXT,
ADD COLUMN IF NOT EXISTS portfolio_image_2 TEXT,
ADD COLUMN IF NOT EXISTS portfolio_image_3 TEXT;

-- Verify columns were added
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'designers' 
AND column_name LIKE 'portfolio_image%';</pre>
        <button class="copy-btn" onclick="copySQL()">Copy SQL</button>
        <br>
        <a href="https://supabase.com/dashboard/project/frwchtwxpnrlpzksupgm/sql/new" target="_blank">
            ‚Üí Open Supabase SQL Editor
        </a>
    </div>

    <div class="step">
        <h2>Step 2: Migrate Existing Data</h2>
        <p>After adding the columns, click the button below to migrate portfolio data:</p>
        <button id="migrate-btn" onclick="migrateData()">Run Migration</button>
        <div id="migration-status"></div>
    </div>

    <div class="step">
        <h2>Step 3: Verify Migration</h2>
        <button id="verify-btn" onclick="verifyMigration()" disabled>Verify Migration</button>
        <div id="verify-status"></div>
    </div>

    <script>
        const SUPABASE_URL = 'https://frwchtwxpnrlpzksupgm.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyd2NodHd4cG5ybHB6a3N1cGdtIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NDQxNjM1OCwiZXhwIjoyMDY5OTkyMzU4fQ.etecMSfQ317vkouRXaMX3Jqg669kf5KL4pE08V03TV8';

        function copySQL() {
            const sql = document.getElementById('sql-query').textContent;
            navigator.clipboard.writeText(sql);
            alert('SQL copied to clipboard!');
        }

        async function migrateData() {
            const btn = document.getElementById('migrate-btn');
            const status = document.getElementById('migration-status');
            
            btn.disabled = true;
            status.innerHTML = '<div class="status warning">‚è≥ Running migration...</div>';
            
            try {
                // First check if columns exist
                const checkResponse = await fetch(`${SUPABASE_URL}/rest/v1/designers?select=id,portfolio_image_1&limit=1`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (!checkResponse.ok) {
                    throw new Error('Portfolio columns not found. Please run Step 1 first.');
                }
                
                // Get designers with tools data
                const response = await fetch(`${SUPABASE_URL}/rest/v1/designers?select=id,tools,portfolio_image_1&tools=not.is.null`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                const designers = await response.json();
                let migrated = 0;
                let skipped = 0;
                
                for (const designer of designers) {
                    if (designer.portfolio_image_1) {
                        skipped++;
                        continue;
                    }
                    
                    if (Array.isArray(designer.tools) && designer.tools.length > 0) {
                        const updateData = {
                            portfolio_image_1: designer.tools[0] || null,
                            portfolio_image_2: designer.tools[1] || null,
                            portfolio_image_3: designer.tools[2] || null,
                            tools: []
                        };
                        
                        await fetch(`${SUPABASE_URL}/rest/v1/designers?id=eq.${designer.id}`, {
                            method: 'PATCH',
                            headers: {
                                'apikey': SUPABASE_KEY,
                                'Authorization': `Bearer ${SUPABASE_KEY}`,
                                'Content-Type': 'application/json',
                                'Prefer': 'return=minimal'
                            },
                            body: JSON.stringify(updateData)
                        });
                        
                        migrated++;
                    }
                }
                
                status.innerHTML = `
                    <div class="status success">
                        ‚úÖ Migration completed!<br>
                        - Migrated: ${migrated} designers<br>
                        - Skipped: ${skipped} designers (already migrated)
                    </div>
                `;
                
                document.getElementById('verify-btn').disabled = false;
                
            } catch (error) {
                status.innerHTML = `<div class="status error">‚ùå Error: ${error.message}</div>`;
                btn.disabled = false;
            }
        }
        
        async function verifyMigration() {
            const status = document.getElementById('verify-status');
            
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/designers?select=id,email,portfolio_image_1,portfolio_image_2,portfolio_image_3&or=(portfolio_image_1.not.is.null,portfolio_image_2.not.is.null,portfolio_image_3.not.is.null)&limit=5`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                const designers = await response.json();
                
                if (designers.length > 0) {
                    let html = '<div class="status success">‚úÖ Migration verified! Found designers with portfolio images:</div><ul>';
                    designers.forEach(d => {
                        const count = [d.portfolio_image_1, d.portfolio_image_2, d.portfolio_image_3].filter(Boolean).length;
                        html += `<li>${d.email}: ${count} image(s)</li>`;
                    });
                    html += '</ul>';
                    status.innerHTML = html;
                } else {
                    status.innerHTML = '<div class="status warning">‚ö†Ô∏è No designers with portfolio images found yet.</div>';
                }
            } catch (error) {
                status.innerHTML = `<div class="status error">‚ùå Verification error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>